<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr">
  <!-- BEGIN: Head-->

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" />
    <meta
      name="description"
      content="Modern admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities with bitcoin dashboard." />
    <meta
      name="keywords"
      content="admin template, modern admin template, dashboard template, flat admin template, responsive admin template, web app, crypto dashboard, bitcoin dashboard" />
    <meta name="author" content="PIXINVENT" />
    <title>Channel Manager</title>

    <link
      rel="apple-touch-icon"
      href="./app-assets/images/ico/apple-icon-120.png" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="./app-assets/images/ico/favicon.ico" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i%7CQuicksand:300,400,500,700"
      rel="stylesheet" />

    <!-- BEGIN: Vendor CSS-->
    <link
      rel="stylesheet"
      type="text/css"
      href="./app-assets/vendors/css/vendors.min.css" />
    <!-- END: Vendor CSS-->

    <!-- BEGIN: Theme CSS-->
    <link
      rel="stylesheet"
      type="text/css"
      href="./app-assets/css/bootstrap.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="./app-assets/css/bootstrap-extended.css" />
    <link rel="stylesheet" type="text/css" href="./app-assets/css/colors.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="./app-assets/css/components.css" />
    <!-- END: Theme CSS-->

    <!-- BEGIN: Page CSS-->
    <link
      rel="stylesheet"
      type="text/css"
      href="./app-assets/css/core/menu/menu-types/horizontal-menu.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="./app-assets/css/core/colors/palette-gradient.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="./app-assets/css/pages/login-register.css" />
    <!-- END: Page CSS-->

    <script type="module" src="./ir-webcmp/ir-webcmp.esm.js"></script>

    <style></style>
  </head>

  <body>
    <ir-channel-manager></ir-channel-manager>
    <!-- <ir-channel-select></ir-channel-select> -->

    <!-- <ir-input-text
      label-background="white"
      label-position="right"
      label-border="none"></ir-input-text> -->

    <script>
      const API_URL = "https://gateway.igloorooms.com";
      const TICKET = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE2OTM4MTg0NDQsIkNMQUlNLTAxIjoicktLMi9DY1dQQnM9IiwiQ0xBSU0tMDIiOiI5UStMQm93VTl6az0iLCJDTEFJTS0wMyI6Ilp3Tys5azJoTzUwPSIsIkNMQUlNLTA0IjoiYXBWblRyR3hBaytaaVZ1WHMyRElDOU1mYkRmTzZGWCt5K3FkSE5xUE9nTT0ifQ.EgzE3JDyNay3_wT8_ofusbIPQEjmLCmZAtVbi_7ERC4"
    
      const irChannelManager = document.querySelector("ir-channel-manager");
      let NOSQL_ID = -1;
    
      function fetchData(url, requestOptions, successCallback, errorCallback) {
        fetch(url, requestOptions)
          .then((response) => response.json())
          .then(successCallback)
          .catch(errorCallback);
      }
    
      function getData() {
        const url = `${API_URL}/IR/Get_Nosql_By_ENTITY_NAME_ENTITY_KEY_ENTITY_FIELD?Ticket=${TICKET}`;
        const headers = new Headers({ "Content-Type": "application/json" });
        const requestData = {
          ENTITY_NAME: "TBL_AC",
          ENTITY_KEY: "42",
          ENTITY_FIELD: "CHANNELS",
        };
    
        const requestOptions = {
          method: "POST",
          headers: headers,
          body: JSON.stringify(requestData),
          redirect: "follow",
        };
    
        const successCallback = (result) => {
          const res = JSON.parse(result.My_Result[0].DATA);
          irChannelManager.listData = res;
          NOSQL_ID = res.length > 0 ? result.My_Result[0].NOSQL_ID : -1;
        };
    
        const errorCallback = (error) => {
          console.log("getData error:", error);
        };
    
        fetchData(url, requestOptions, successCallback, errorCallback);
      }
    
      function updateData(data) {
        const url = `${API_URL}/IR/Edit_Nosql?Ticket=${TICKET}`;
        const headers = new Headers({ "Content-Type": "application/json" });
        const requestData = {
          NOSQL_ID: NOSQL_ID,
          ENTITY_NAME: "TBL_AC",
          ENTITY_KEY: 42,
          ENTITY_FIELD: "CHANNELS",
          DATA: JSON.stringify(data),
        };
    
        const requestOptions = {
          method: "POST",
          headers: headers,
          body: JSON.stringify(requestData),
          redirect: "follow",
        };
    
        const successCallback = () => {
          getData(); // Refresh data after update
        };
    
        const errorCallback = (error) => {
          console.log("updateData error:", error);
        };
    
        fetchData(url, requestOptions, successCallback, errorCallback);
      }
    
      function deleteData(nosqlId) {
        const url = `${API_URL}/IR/Delete_Nosql?Ticket=${TICKET}`;
        const headers = new Headers({ "Content-Type": "application/json" });
        const requestData = {
          NOSQL_ID: nosqlId,
          ENTITY_NAME: "TBL_AC",
          ENTITY_KEY: 42,
          ENTITY_FIELD: "CHANNELS",
        };
    
        const requestOptions = {
          method: "POST",
          headers: headers,
          body: JSON.stringify(requestData),
          redirect: "follow",
        };
    
        const successCallback = () => {
          console.log("Data deleted successfully");
          getData(); // Refresh data after delete
        };
    
        const errorCallback = (error) => {
          console.log("deleteData error:", error);
        };
    
        fetchData(url, requestOptions, successCallback, errorCallback);
      }
    
      document.addEventListener("DOMContentLoaded", () => {
        getData();
      });
    
      irChannelManager.addEventListener("fetchApi", (e) => {
        console.log("Fetching to server", NOSQL_ID);
        updateData(e.detail);
      });
    
      irChannelManager.addEventListener("requestApiDelete", (e) => {
        deleteData(e);
      });
    </script>
    
  </body>
</html>
